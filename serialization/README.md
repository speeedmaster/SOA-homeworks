# Сравнение форматов сериализации (C++)

Данный проект помогает сравнивать различные протоколы сериализации данных в языке C++.

## Описание

Проект состоит из одного прокси-сервера и нескольких worker-серверов, каждый из которых отвечает за свой формат сериализации. Шаблонная структура позволяет с легкостью добавить новые форматы.

Proxy_server и worker-ы запускаются в отдельных контейнерах в docker-compose. Использование вне docker-compose не рекомендуется, потому что для резолвинга нужного воркера используется знание, что его хост называется как формат сериализации. Чтобы работать вне docker-compose вместо формата в аргументах следует передавать hostname.

Образы прокси-сервера и воркера залиты в docker hub, поэтому для использования вполне достаточно docker compose.

## Запуск контейнеров

Из корня директории:

```bash
serialization$ docker-compose up
```

## Сборка контейнеров

Сначала собирается главынй образ с проектом:

```bash
serialization$ docker build . -t serialization-main
```

Затем собираются proxy_server:

```bash
serialization$ docker build . -f proxy_server/Dockerfile -t serialization-proxy-server
```
И worker:

```bash
serialization$ docker build . -f worker/Dockerfile -t serialization-worker
```

Сделано это было для того, чтобы не пересобирать два раза один и тот же проект для прокси сервера и воркера.

## Взаимодействие с проектом

Из docker compose наружу выведен 2000 UDP порт, на котором proxy_server слушает новые запросы. Запрос - это строка, сериализация запроса вормата json.

## Типы запросов

- Запрос ```get``` - реализует запрос на конкретный воркер, и возвращает ответ с него:
    ```json
    {"method": "get", "args": ["native"]}
    ```

- Запрос ```get_all``` - реализует multicast на все воркеры и возвращает результаты с каждого:
    ```json
    {"method": "get_all", "args": []}
    ```

## Формат ответа

Ответ от воркера - это строка вида ```"{формат сериализации} – {размер сериализованной структуры} – {время сериализации} – {время десериализации}".```

Пример работы:

```bash
~/serialization$ nc -u 127.0.0.1 2000 

{"method": "get", "args": ["native"]}
native   -   141b	- 15304ns	- 17866ns

{"method": "get_all", "args": []}        
msgpack  -   47b	- 10530ns	- 8458ns
protobuf -   95b	- 4024ns	- 3997ns
json     -   190b	- 33277ns	- 8463ns
native   -   141b	- 25408ns	- 30115ns
xml      -   816b	- 36393ns	- 57399ns
yaml     -   231b	- 181425ns	- 31783ns
```